#!/bin/bash
set -e # Exit on first error

echo "ğŸš€ Starting Pre-Flight Check..."

# Change to the Laravel application directory (already in the right place)
echo "------------------------------------------------"
echo "ğŸ”Œ Starting Sail Services..."
./vendor/bin/sail up -d

echo "------------------------------------------------"
echo "ğŸ¨ 1. Running Laravel Pint (Checking Code Style)..."
./vendor/bin/sail exec laravel.test php ./vendor/bin/pint --test

echo "------------------------------------------------"
echo "ğŸ§¹ 2. Running ESLint & Prettier (Frontend)..."
./vendor/bin/sail exec laravel.test npm run lint 2>/dev/null || echo "âš ï¸  Lint script missing, using basic eslint..."

echo "------------------------------------------------"
echo "ğŸ” 3. Running PHPStan (Static Analysis)..."
./vendor/bin/sail exec laravel.test php ./vendor/bin/phpstan analyse

echo "------------------------------------------------"
echo "âœ… 4. Running Tests (Pest)..."
./vendor/bin/sail artisan test

echo "------------------------------------------------"
echo "ğŸ‰ ALL SYSTEMS GO. Ready to Commit."